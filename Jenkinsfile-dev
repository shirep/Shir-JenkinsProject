pipeline {
    agent any
    environment {DOCKERHUB_CREDENTIALS= credentials('dockerhub')}
    stages {
        stage('Checkout') {
            steps {
                script {
                    echo '####Start Checkout####'
                    checkout scm
                }
            }
        }
        stage('Docker Build') {
            steps {
                script {
		    echo '###Start Build###'
                    sh 'pwd'
                    sh 'ls'
                    sh 'docker build -t shir-python-image:$BUILD_NUMBER .'
                }
            }
        }

        stage('Login to Docker Hub') {         
            steps{                            
		sh 'echo $DOCKERHUB_CREDENTIALS_PSW | docker login -u $DOCKERHUB_CREDENTIALS_USR --password-stdin'                 
	        echo 'Login Completed'                
            }           
        }               
        stage('Push Image to Docker Hub') {         
          steps{                            
	        sh 'docker push shir-python-image:$BUILD_NUMBER'                 
            	echo 'Push Image Completed'       
      }           
    }      
  } //stages 
    post {
        success {
            echo 'Success'
        }
        failure {
            echo 'Failed'
        }
    }
}
